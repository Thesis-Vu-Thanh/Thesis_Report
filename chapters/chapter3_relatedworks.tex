\chapter{Related works}
\label{chap:literaturereview}
	\textit{This chapter mentions some related studies on the use of machine techniques to detect malicious requests, their strengths and weaknesses, and evaluate an appropriate approach for this thesis.}
\minitoc
\newpage	

Malicious request detection has been a focus of recent studies, with several malicious request detection systems developed. They propose solutions for particular or different types of harmful requests. Existing malicious website detection approaches can be mainly divided into two categories based on their architecture: A Machine learning-based WAF\index{WAF} using pure ML to detect abnormal requests and Using ML\index{Machine learning (ML)} to improve existing WAF.
% For example, reference \cite{Joshi_sqli} show us their solution to SQLI attack that is one of the most common malicious requests. Joshi and Geetha \cite{Joshi_sqli} detect SQLI attacks using the Naive Bayes machine learning algorithm. Or \cite{sqlmap} automatically generates malicious requests containing sql injection to exploit flaws and take over of database servers. Reference \cite{sqli_ML} trains a Support Vector Machine(SVM) model to detect SQLI attacks.
% Mereani et al. \cite{Mereani2018} has demonstrated that SVM, k-NN, and Random Forest can be used to build classiﬁers for XSS coded in JavaScript giving high accuracy (up to 99.75\%) and precision (up to 99.88\%) when applied to a large real world dataset. One especially intriguing component of this study is that, unlike other studies, a binary measure was employed for all features. This has resulted in greater accuracy and precision than previous tests employing weighted measurements.

\section{Machine Learning-Based WAF}
\label{sec:machine_learning_based}
WAF based on machine learning\index{Machine learning (ML)} is a type of web application firewall built on machine learning techniques to detect and prevent attacks on web applications. It uses machine learning algorithms to analyze data from incoming requests and responses from web applications, thereby creating rules to identify and prevent attacks.
With continuous learning, the machine learning-based WAF can automatically update new rules to detect new and more advanced attacks. This makes it possible for WAF to protect web applications against unknown attacks and ensure the safety of user and business data. Here are some significant articles having an approach by using machine learning to create a web application firewall: 

1.	Shaheed et al. \cite{Shaheed} present a proposed model for a web application firewall that uses machine learning and features engineering to detect common web attacks. Their proposed model uses Naive Bayes with cross-validation (100 Folds) analyzes incoming requests to the web server, parses these requests to extract four features that describe completely HTTP request parts (URL, payload, and headers), and classifies whether a request is normal or an anomaly. Final features are used by WAF to check if the request is normal or anomaly, these features are calculated and extracted based on the basic features. Features extracted in this model are general and can work with any web application. Final features describe all parts of the HTTP request including headers and files. Their proposed model achieved a classification accuracy\index{Accuracy} of 99.6\% with datasets used in research studies in this field and 98.8\% with datasets of real web servers. The authors have performed tests on real data sets and the results show that the proposed method is capable of detecting web attacks with higher accuracy than conventional methods. However, the current implementation supports Linux distributions only. 

2.	Jemal et al. \cite{Jemal} build a smart web application ﬁrewall (SWAF) based on a convolutional neural network that learns from a massive amount of data and can detect malicious HTTP requests based on its learning phase and reduce the attack detection overhead time. They propose two solutions. The ﬁrst one compresses the HTTPrequest. It keeps the necessary parts in the detection of attacks and eliminates the remaining parts which are useless in attack detection. The second one reduces the number of CNN neurons and eliminates the unnecessary one that increases the needed time. In this study, they used 5 fold cross validation to train and test the CNN model. They investigated a method to preprocess the HTTP requests called ASCII embedding, it proved experimentally that by using ASCII embedding, CNN\index{CNN} model achieved better accuracy. It exceeds 98\%, while, using word and character approaches, the accuracy did not overtake 97.6\% and 96.12\%, respectively. However, the ASCII embedding preprocessing method presents an extra analysis time (7.6ms) compared to the word and character embedding methods (3.85ms and 6.2ms,respectively). To solve this problem, they filtered CNN neurons and achieved high attack detection rate (98.1\%) with overhead time does not exceed 2.3ms.

3.	Dawadi et al.\cite{Dawadi}'s research work makes a comparative analysis between normal HTTP traffic and attack traffic that identifies attack-indicating parameters and features. This study introduces a layer architecture of WAF. Their proposed WAF consists of two modules in the layered architecture using Long short-term memory(LSTM)\index{LSTM} , one for DDoS attack detection in the first layer and another for SQL injection and XSS\index{XSS} detection in the second layer. The first detection layer was a DDoS attack detection model with an accuracy of 97.57\%, and the second layer was for XSS and SQL injection attack detection with an accuracy\index{Accuracy} of 89.34\%. Rather than training the module with the single dataset, training the module with separate datasets would lead to better results, as the nature of the data and attacks are different. The result also proves that the analysis of features and parameters for attack detection helps to reduce false positives during traffic filtering, which is critical for the effectiveness of WAF.


4.	Toprak et al. \cite{Toprak}'s research focuses on WAF\index{WAF} systems with single and stacked LSTM\index{LSTM} layers architecture that reveal hyper-parameter values for the best performance using character sequences of user-supplied data. A semi-supervised approach is used and trained with PayloadAllTheThings dataset containing real attack payloads and only normal payloads of HTTP Dataset CSIC 2010 are used. F1 scores\index{F1-score} are used to calculate the success rate of the approach, which determines whether the user input is recognized as malicious or normal. High F1 scores and success in the detection and classification of the attacks were shown by the suggested model.
To analyze character sequences of malicious web application payloads and implement various models with various hyper-parameters, the deep learning model with LSTM layers is analyzed and implemented throughout the work. This allows the authors to identify the best deep-learning structure for detection and to determine whether the supplied input words are benign or malicious. One may conclude that the resulting models, based on extensive experiments and analysis of various models with various hyper-parameters, are promising for the detection of malicious HTTP web requests for specific attack types using corresponding attack payloads with a relatively small attack payload dataset using a semi-supervised learning method. However, there is a genuine problem with the lack of a dataset that offers sample payloads for the relevant online assaults and web answers.

5.	The goal of Gogoi et al.\cite{Gogoi}'s research is to assess the effectiveness of various machine learning (ML) methods in identifying XSS\index{XSS} attacks in web apps and websites while employing Support Vector Machine (SVM)\index{SVM} to detect XSS assaults. They developed a custom Apache webserver module that intercepts requests to the web application using hooks provided by Apache webserver. SVM has the advantage of being robust against overfitting problems, especially for text data due to high dimensional space. The authors also use 10-Fold cross-validation to prevent overfitting in SVM algorithm. The precision\index{Precision}, recall and f1-score of both linear and nonlinear SVM indicates that the algorithms are able to successfully separate the XSS attack inputs from benign web application inputs.  Though the non-linear SVM performs better in terms of accuracy and f1-score, it takes much longer time than the linear SVM for model fitting. The experimental results allow us to conclude that ways to detect XSS assaults have advantages over more conventional approaches. XSS attacks can be detected more accurately when ML technique is used in conjunction with conventional procedures. 
\section{Improving existing WAF using machine learning}
\label{sec: improving_waf}
Combining machine learning\index{Machine learning (ML)} and traditional methods in WAF can help improve the effectiveness of web application protection while minimizing errors and confusion in detecting and preventing web attacks. Conventional methods in WAF are believed to be correct. However, these methods may not be flexible enough and are difficult to adapt to new and advanced attacks. Therefore, combining traditional methods with machine learning enhances WAF's ability to detect and prevent attacks.
Here are some significant articles having an approach by using machine learning to improve a web application firewall: 

1.	Truong et al. \cite{Truong} aim to utilize machine learning methods to improve WAF performance. The authors discusse popular types of attacks on web applications and the survey of machine learning methods in the attack detection task to build an algorithm for automatic detection attacks based on the support vector machine (SVM) and analysis of HTTP requests. The scheme for classification process consists of 7 main stages: data  collection  to create a query base, preliminary data processing, payload comparison, checking regular expressions, calculation of request attributes, converting text data into vectors, and classification of queries based on the support vector machine. The researchers use 3-grams with cross-validation to verify the results of the approach. According to the experimental results, the proposed approach has both accuracy and F1-score at approximately 99.9\%. The new approach is only effective for variable query length attacks (code injection, cross-site scripting) and requires high computational power as the dataset grows in size. The authors also suggest some methods to improve the performance of the model, such as using a combination of machine learning methods, increasing the number of quality attributes of queries or updating signature databases.

2.	Devi et al. \cite{Devi}'s research proposed a machine learning-based approach for a web application firewall. In this paper, one of the classification algorithms in machine learning is logistic regression\index{Logistic regression} used to classify good and bad queries. The queries were extracted and classified as legitimate and malicious using Logistic Regression Classifier. All experiments were programmed and evaluated in
Jupyter Notebooks, an interactive Python environment for data science. After converting data to an appropriate format using python scripts, they using the "bag of words" technique to convert data to numeric features. The N-Gram method is applied, and combined with TF-IDF vectorizer to turn the data into TF-IDF\index{TF-IDF} values to gives n-grams weights, then apply Logistic Regression\index{Logistic regression}. The logistic Regression classifier (where a 3- grams vectorizer) had 99.93\% accuracy\index{Accuracy},a precision\index{Precision} of 98.83\% and F1-score of 99\%. However, the dataset used to train and evaluate the proposed method is relatively small compared to the vast amount of web application content available on the internet, which may limit the generalizability of the proposed method.

3.	N.-T. Tran et al. \cite{Tin} build a WAF\index{WAF} system based on ModSecurity with ModSecurity CRS, which focuses on lowering the false-positive\index{False positive} rate of ModSecurity CRS based on machine learning\index{Machine learning (ML)} techniques. This approach specifically blends ModSecurity CRS and machine learning. The authors suggested a strategy combining ModSecurity and ModSecurity CRS with Decision Tree and Random Forest machine learning models based on the created dataset and the accessible data. Based on the experimental results, they show that the proposed method has signiﬁcantly improved the initial false-positive rate of the ModSecurity CRS. However, in order to reduce the false-positive rate to this level (about 1.26\%), the true-positive rate had to decrease to 69.96\% (with Random Forest model). They also test their WAF system on real websites, also with Random Forest and only 0.29\% of requests are wrongly blocked. With the trained model, the authors have been able to drastically lower the false-positive rate of ModSecurity CRS, making it more suited for the actual application. However, the proposed models do not increase the capacity to recognize any novel sorts of assaults; rather, they just reduce the false-positive rate in ModSecurity CRS's final decision formula.

4.	The research of Alshammari et al.\cite{Alshammari} suggests a detection architecture with several ML models for supplying IDS to find anomalous network traffic. This study proposes a system for detecting anomalies in network traffic by providing an IDS with an ML model. A dataset consisting of both malicious and legitimate traffic will be used. The data preprocessing phase significantly influences this work result. While others obtaining the accuracy of above 94\%, with the D-tree, ANN, Random Forest and Decision Tree's result at 100\%, the Naïve Bayes model and SVM\index{SVM} is not suitable for this model with the accuracy of approximately 60\%. Although the machine learning models utilized produced good results, the provided model had certain drawbacks. To extract the features of communication traffic and provide a real-time response, IDS security systems for computer networks must be extremely quick. The performance of fitting the system and evaluating it was affected by the large dataset that underlies the provided model and is regarded as a form of big data. In addition, the application of this approach in actual networks will slow down the necessary speed.

% Khoi. Le et al. \cite{Khoi} suggested an approach of extracting WAF rules and trained a machine learning with the decision model independent from the rules themselves. This makes the model more self-reliant and the overall result more neutral. Our module is inspired by this approach.
5.	Khoi. Le et al. \cite{Khoi} suggested an approach of extracting WAF rules and trained a machine learning with the decision model independent from the rules themselves. This makes the model more self-reliant and the overall result more neutral. The module has been tested, and though it is not completed yet, it shows potential. Eventhough this paper gains positive results, it also has some drawbacks. The dataset collected for phishing website detector is still small and skewed, the ML model is small and cannot cover all phishing cases. The malicious request validator has only been trained with three categories out of five and the authors only tested on one programming language in server-side script. This validator is still not field-tested on any production environment yet. Our module is inspired by this approach. We aim to finalize this module but combine it with another machine learning model to specialize it for the goal of determining incoming requests independent of the WAF rule.

% Malicious request detection has been a focus of recent studies, with several malicious request detection systems developed. They propose solutions for particular or different types of harmful requests. For example, reference \cite{Joshi_sqli} show us their solution to SQLI attack which is one of the most common malicious requests. Joshi and Geetha \cite{Joshi_sqli} detect SQLI attacks using the Naive Bayes machine learning algorithm. Or \cite{sqlmap} automatically generates malicious requests containing SQL injection to exploit flaws and take over of database servers. Reference \cite{sqli_ML} train a Support Vector Machine(SVM) model to detect SQLI attacks.\\ \newline
% Fawaz Mereani and Jacob Howe et al\cite{Mereani2018} have demonstrated that SVM, k-NN, and Random Forest can be used to build classiﬁers for XSS coded in JavaScript giving high accuracy (up to 99.75\%) and precision (up to 99.88\%) when applied to a large real-world dataset. One especially intriguing component of this study is that, unlike other studies, a binary measure was employed for all features. This has resulted in greater accuracy and precision than previous tests employing weighted measurements.\\ \newline
% Laughter et al \cite{laughter2021} integrated the HTTP request features in the process of visiting the website into the detection feature set. By extracting the content of each field in the request header and request body, classification methods such as decision trees and SVM were used to complete the research.\\
% \newline
% Alshammari, Amirah and Aldribi, Abdulaziz et al \cite{Alshammari2021} present a reliable model running in Real-time to detect malicious data flow traffic on the cloud depending on the ML supervised techniques based on the ISOT-CID dataset that contains network traffic data features. When tested using cross-validation and split-validation, DTREE and Random Forest both produced the best accuracy results. Their two models did not fail in any of the classification processes used to assess different portions or folds of the dataset.\\
% \newline
% This group of researchers \cite{s22093373} proposed an approach to detect malicious URLs using ensemble learning. They use TF-IDF to pre-process input URLs, then applied Rain Forest Ensemble-Based for prediction and an artificial neural network (ANN) classifier was constructed for decision making. Results show that this approach significantly improved the detection performance, achieving 96.80\% compared with the best 90.4\% achieved by the URL-based features. The false-positive rate was significantly decreased to 3.1\% compared with 12\% performed by the URL-based model. \\ \newline
% Khoi. Le et al \cite{Khoi} suggested an approach of extracting WAF rules and trained a machine learning with the decision model independent from the rules themselves. This makes the model more self-reliant and the overall result more neutral. Our module is inspired by this approach.\\ 
